<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pers√∂nlichkeitsautomat 3000</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f0f0f0, #fefefe);
      color: #333;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      font-size: 2rem;
      margin-bottom: 2rem;
    }
    textarea, input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #45a049;
    }
    .frage-container {
      margin-top: 1rem;
    }
    .profil-box {
      background: #fff;
      padding: 1.5rem;
      margin-top: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      white-space: pre-wrap;
    }
    label {
      font-weight: bold;
    }
    #fragenContainer textarea {
      min-height: 80px;
    }
    #statusBox {
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h1>üéõÔ∏è Pers√∂nlichkeitsautomat 3000</h1>
  <label>‚úèÔ∏è Fragen bearbeiten (eine pro Zeile)</label>
  

  <label>üéØ Preset w√§hlen</label>
  <select id="presetSelect" onchange="ladePreset()">
    <option value="">‚Äì Auswahl ‚Äì</option>
    <option value="Gianluca">Gianluca</option>
  
<button onclick="exportPresets()">‚¨áÔ∏è Presets exportieren</button>
<button onclick="importPresets()">‚¨ÜÔ∏è Presets importieren</button>

  <label>Wann bist du geboren?</label>
  <input type="date" id="geburtstag" />

  

<button onclick="loescheApiKey()">üßπ API-Key l√∂schen</button>

  <div id="fragenContainer"></div>

  <button onclick="generiereFragefelder()">üîÑ Fragen √ºbernehmen</button>
  <button onclick="generiereProfil()">üîÆ Auswertung starten</button>
  <button onclick="shuffleFragen()">üîÄ Fragen mischen</button>

  <button onclick="exportAsText()">üìÑ Exportieren als Textdatei</button>

  <div id="profil" class="profil-box"></div>

  
    const presets = JSON.parse(localStorage.getItem("presets") || '{}') || {
      Gianluca: [
        "Wenn du einen Tag in einem Film leben m√ºsstest ‚Äì welcher w√§re das und warum?",
        "Wenn dich jemand fragt, woher du kommst ‚Äì was antwortest du?",
        "Was schiebst du immer wieder vor dir her, weil‚Äôs einfach m√ºhsam ist?",
        "Was war dein letzter innerer Applaus-Moment?",
        "Supermarkt-Challenge: Welche drei Artikel w√ºrdest du kaufen, um die Kassiererin maximal zu verwirren?",
        "Du darfst ein Abendessen mit drei Figuren haben ‚Äì real oder fiktiv. Wen l√§dst du ein und warum?",
        "Angenommen, du wirst verhaftet ‚Äì wof√ºr w√ºrde dich dein Umfeld am ehesten verd√§chtigen?",
        "Wenn Geld absolut keine Rolle spielen w√ºrde ‚Äì was w√ºrdest du beruflich machen, einfach nur aus Freude?",
        "Was brauchst du, um dich rundum wohl und frisch zu f√ºhlen ‚Äì innen wie au√üen?",
        "Wenn du einen neuen Feiertag erfinden k√∂nntest ‚Äì was w√§re das Thema und wie w√ºrde man feiern?"
      ]
    };

    function ladePreset() {
      const presetName = document.getElementById("presetSelect").value;
      if (presetName && presets[presetName]) {
        document.getElementById("fragenText").value = presets[presetName].join("
");
        generiereFragefelder();
      }
    }

    function speicherePreset() {
  const name = prompt("Wie soll das neue Preset hei√üen?");
  if (!name) return;
  const fragen = document.getElementById("fragenText").value.trim().split("
");
  presets[name] = fragen;
  localStorage.setItem("presets", JSON.stringify(presets));
  const select = document.getElementById("presetSelect");
  if (!Array.from(select.options).some(opt => opt.value === name)) {
    const option = document.createElement("option");
    option.value = name;
    option.textContent = name;
    select.appendChild(option);
  }
  select.value = name;
  alert("Preset gespeichert als: " + name);
}
    const defaultFragen = [
      "Wenn du einen Tag in einem Film leben m√ºsstest ‚Äì welcher w√§re das und warum?",
      "Wenn dich jemand fragt, woher du kommst ‚Äì was antwortest du?",
      "Was schiebst du immer wieder vor dir her, weil‚Äôs einfach m√ºhsam ist?",
      "Was war dein letzter innerer Applaus-Moment?",
      "Supermarkt-Challenge: Welche drei Artikel w√ºrdest du kaufen, um die Kassiererin maximal zu verwirren?",
      "Du darfst ein Abendessen mit drei Figuren haben ‚Äì real oder fiktiv. Wen l√§dst du ein und warum?",
      "Angenommen, du wirst verhaftet ‚Äì wof√ºr w√ºrde dich dein Umfeld am ehesten verd√§chtigen?",
      "Wenn Geld absolut keine Rolle spielen w√ºrde ‚Äì was w√ºrdest du beruflich machen, einfach nur aus Freude?",
      "Was brauchst du, um dich rundum wohl und frisch zu f√ºhlen ‚Äì innen wie au√üen?",
      "Wenn du einen neuen Feiertag erfinden k√∂nntest ‚Äì was w√§re das Thema und wie w√ºrde man feiern?"
    ];

    function aktualisierePresetDropdown() {
  const select = document.getElementById("presetSelect");
  select.innerHTML = '<option value="">‚Äì Auswahl ‚Äì</option>';
  Object.keys(presets).forEach(name => {
    const option = document.createElement("option");
    option.value = name;
    option.textContent = name;
    select.appendChild(option);
  });
}

aktualisierePresetDropdown();


    generiereFragefelder();

    function generiereFragefelder() {
      const fragen = document.getElementById("fragenText").value.trim().split("\n");
      const container = document.getElementById("fragenContainer");
      container.innerHTML = "";
      fragen.forEach((frage, i) => {
        const wrapper = document.createElement("div");
        wrapper.className = "frage-container";
        wrapper.innerHTML = `<label>${frage}</label><textarea id="antwort${i}"></textarea>`;
        container.appendChild(wrapper);
      });
    }

    async function generiereProfil() {
      const fragen = document.getElementById("fragenText").value.trim().split("\n");
      const geburtstag = document.getElementById("geburtstag").value;
      const antworten = fragen.map((_, i) => document.getElementById("antwort" + i).value);
      const apiKey = document.getElementById("apiKey").value.trim();

      if (!apiKey || !geburtstag || antworten.some(a => !a.trim())) {
        alert("Bitte API Key, Geburtstag und alle Antworten ausf√ºllen!");
        return;
      }

      const birthDateObj = new Date(geburtstag);
      const geburtsJahr = birthDateObj.getFullYear();
      const geburtsTag = birthDateObj.toLocaleDateString("de-DE", { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

      const prompt = `Erstelle eine kreative, unterhaltsame, absurde Pers√∂nlichkeitsanalyse basierend auf diesen Antworten und dem Geburtsdatum. Nenne Sternzeichen, chinesisches Tierkreiszeichen, absurde und lustige Tagesfakten (vom ${geburtsTag}) und verpacke alles in einem unterhaltsamen Text (ca. 2500 Zeichen):

` +
        `Geburtstag: ${geburtstag} (Jahr: ${geburtsJahr})

` +
      document.getElementById("profil").innerText = "‚è≥ KI denkt nach ...";

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: "Du bist ein witziger, kreativer Pers√∂nlichkeitsanalytiker." },
              { role: "user", content: prompt }
            ],
            max_tokens: 1500,
            temperature: 0.9
          })
        });
        const data = await response.json();
        document.getElementById("profil").innerText = data.choices?.[0]?.message?.content || "Keine Antwort erhalten.";
      } catch (error) {
        document.getElementById("profil").innerText = "Fehler bei der KI-Anfrage. Check deinen API-Key.";
        console.error(error);
      }
    }

    async function generiereNeueFragen() {
      const apiKey = document.getElementById("apiKey").value.trim();
      if (!apiKey) return alert("Bitte zuerst API-Key eingeben!");
      const prompt = "Gib mir 10 kreative, ungew√∂hnliche, unterhaltsame Fragen f√ºr ein Pers√∂nlichkeitsinterview im Podcast-Stil. Jede Frage in einer Zeile.";

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "user", content: prompt }
            ],
            max_tokens: 500,
            temperature: 0.95
          })
        });
        const data = await response.json();
        const neueFragen = data.choices?.[0]?.message?.content.trim();
        if (neueFragen) {
          document.getElementById("fragenText").value = neueFragen;
          generiereFragefelder();
        }
      } catch (error) {
        alert("Fehler beim Generieren neuer Fragen.");
        console.error(error);
      }
    }

    const apiKeyField = document.getElementById("apiKey");
if (localStorage.getItem("openaiKey")) {
  apiKeyField.value = localStorage.getItem("openaiKey");
  checkAPIStatus();
}
apiKeyField.addEventListener("change", () => {
  localStorage.setItem("openaiKey", apiKeyField.value.trim());
  checkAPIStatus();
});

    function loescheApiKey() {
  localStorage.removeItem("openaiKey");
  document.getElementById("apiKey").value = "";
  document.getElementById("statusBox").innerText = "üîå API-Key gel√∂scht";
}


      const apiKey = apiKeyField.value.trim();
      if (!apiKey) {
        document.getElementById("statusBox").innerText = "‚ùå Kein API Key eingetragen";
        return;
      }
      fetch("https://api.openai.com/v1/models", {
        headers: { "Authorization": `Bearer ${apiKey}` }
      })
      .then(res => {
        if (res.ok) {
          document.getElementById("statusBox").innerText = "‚úÖ API-Verbindung aktiv";
        } else {
          document.getElementById("statusBox").innerText = "‚ö†Ô∏è API-Key ung√ºltig oder Verbindung gest√∂rt";
        }
      })
      .catch(() => {
        document.getElementById("statusBox").innerText = "‚ö†Ô∏è Verbindung fehlgeschlagen";
      });
    }


      const content = document.getElementById("profil").innerText;
      if (!content) return alert("Es gibt noch keinen Text zum Exportieren.");
      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "persoenlichkeitsprofil.txt";
      link.click();
    }
  function shuffleFragen() {
  const fragen = document.getElementById("fragenText").value.trim().split("
");
  for (let i = fragen.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [fragen[i], fragen[j]] = [fragen[j], fragen[i]];
  }
  document.getElementById("fragenText").value = fragen.join("
");
  generiereFragefelder();
}


function exportPresets() {
  const blob = new Blob([JSON.stringify(presets, null, 2)], { type: "application/json" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "presets.json";
  link.click();
}

function importPresets() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".json";
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const imported = JSON.parse(event.target.result);
        Object.keys(imported).forEach(name => {
          presets[name] = imported[name];
        });
        localStorage.setItem("presets", JSON.stringify(presets));
        aktualisierePresetDropdown();
        alert("Presets erfolgreich importiert!");
      } catch (err) {
        alert("Fehler beim Importieren der Datei.");
      }
    };
    reader.readAsText(file);
  };
  input.click();
});
        alert("Presets erfolgreich importiert!");
      } catch (err) {
        alert("Fehler beim Importieren der Datei.");
      }
    };
    reader.readAsText(file);
  };
  input.click();
}


</html>
